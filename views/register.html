<!-- login.html -->

<!DOCTYPE html>
<html lang="en">
<head>
    <title>shop</title>
    <!-- JQuery -->
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.7.1/jquery.min.js"></script>
    <script type="text/javascript" src="/js/common.js"></script>
    <link rel="stylesheet" href="/css/auth.css">
</head>
<body>
    <style>
    /* Style the error message */
    .email-check {
        color: rgb(21, 21, 21);
        font-weight: bold;
        margin-top: 5px;
        display: none; /* Initially hidden */
    }
    </style>

    <!-- navbar -->
    <div id="navbar-placeholder"></div>

    <div id="main-content" class="container-fluid" style="padding-top: 3rem; font-family: 'Ralewa', sans-serif;">
        <!-- auth page -->
        <div class="auth px-3 px-md-5">
            <h1 class="py-3">CREATE YOUR ACCOUNT</h1>
            <h4 class="mb-5">Have an account? <a href="/login" style="text-decoration: none; text-wrap: nowrap;">Log in now</a></h4>
            <button class="brandBtn mb-4">
                <img 
                    src="https://cdn4.iconfinder.com/data/icons/logos-brands-7/512/google_logo-google_icongoogle-512.png" 
                    alt="google">
                <span>CONTINUE WITH GOOGLE</span>
            </button>
            <button class="brandBtn mb-4">
                <img 
                    src="https://cdn2.iconfinder.com/data/icons/social-media-2285/512/1_Facebook_colored_svg_copy-1024.png" 
                    alt="google">
                <span>CONTINUE WITH FACEBOOK</span>
            </button>
            <button class="brandBtn">
                <img 
                    src="https://cdn2.iconfinder.com/data/icons/black-white-social-media/32/online_social_media_apple-1024.png" 
                    alt="google">
                <span>CONTINUE WITH APPLE</span>
            </button>
            <h5 class="my-4">OR</h5>
            <h2 class="mb-4">CONTINUE WITH YOUR EMAIL ADDRESS</h2>
            <form action="/register" method="POST" id="register-form">
                <div class="error-message"></div>

                <!-- email -->
                <div class="mb-3 form-input">
                    <input style="margin-bottom: 5px;" placeholder=" " type="email" id="email" name="email" required>
                    <label for="email">EMAIL*</label>
                    <div class="email-check" id="email-check"></div>
                </div>

                <!-- password -->
                <div class="mb-3 form-input">
                    <input placeholder=" " type="password" id="password" name="password" required minlength="8">
                    <label for="password">PASSWORD*</label>
                    <button id="show-password" type="button" onclick="showPassword()">
                        <span class="material-symbols-sharp">
                            visibility
                        </span>
                    </button>
                </div>

                <!-- first name -->
                <div class="mb-3 form-input">
                    <input placeholder=" " type="text" id="firstName" name="firstName" required>
                    <label for="firstName">FIRST NAME*</label>
                </div>
                
                <!-- last name -->
                <div class="mb-3 form-input">
                    <input placeholder=" " type="text" id="lastName" name="lastName" required>
                    <label for="lastName">LAST NAME*</label>
                </div>
                
                <!-- bio -->
                <div class="mb-3 form-input">
                    <textarea placeholder=" " id="bio" name="bio" required></textarea>
                    <label for="bio">BIO*</label>
                </div>
                
                <!-- address -->
                <div class="mb-3 form-input">
                    <input placeholder=" " type="text" id="address" name="address" required>
                    <label for="address">ADDRESS*</label>
                </div>

                <!-- access -->
                <div class="mb-3 form-input">
                    <select aria-placeholder="ACCESS*" id="access" name="access" required>
                        <option value="user">User</option>
                        <option value="admin">Admin</option>
                    </select>
                </div>
                
                <!-- phone number -->
                <div class="mb-3 form-input">
                    <input placeholder=" " type="tel" id="phoneNumber" name="phoneNumber" required>
                    <label for="phoneNumber">PHONE NUMBER*</label>
                </div>

                <button type="submit" id="submit-btn">CREATE MY PROFILE</button>
            </form>
        </div>
    </div>

    <script>
        let emailExists = false;

        document.getElementById('email').addEventListener('input', async (event) => {
            try {
                const response = await fetch('/user/all');
                const input_email = document.getElementById('email').value;
                const email_check = document.getElementById('email-check');
                if (!response.ok) {
                    throw new Error(`HTTP error! status: ${response.status}`);
                }

                const usersData = await response.json();
                for(let i = 0; i < usersData.length; i++) {
                    console.log(usersData[i].email);
                    if(input_email === usersData[i].email) {
                        email_check.textContent = "Oops! This email is already registered. Please use another one.";
                        email_check.style.display = 'block';
                        emailExists = true;
                        break;
                    }
                }

            } catch (error) {
                console.error('Error fetching cart data:', error);
                // Handle errors gracefully (e.g., display an error message)
            }
        });

        document.getElementById('register-form').addEventListener('submit', async(event) => {
            event.preventDefault();

            if (emailExists) {
                    // Focus the email input and scroll to it if the email already exists
                    document.getElementById('email').focus();
                    document.getElementById('email').scrollIntoView({ behavior: 'smooth', block: 'center' });
                } else {
                    // If email doesn't exist, submit the form
                    event.target.submit();
                }
        });

    </script>
</body>
</html>
